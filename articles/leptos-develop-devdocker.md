---
title: Leptosé–‹ç™ºç’°å¢ƒã‚’DevDockerã§ä½œæˆã—ãŸè©±
emoji: ğŸ’»
type: tech # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [rust,webassembly,docker,devdocker]
published: false
---

## ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã«ã‚ãŸã‚Šã€**Docker**ã«é–¢ã™ã‚‹çŸ¥è­˜ã‚„æŠ€è¡“ã®èª¬æ˜ã¯è¡Œã‚ãªã„ãŸã‚ã€
ãã‚Œã«é–¢ã—ã¦ã¯ä»–ã®è¨˜äº‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
ã¾ãŸã€ãƒªãƒã‚¸ãƒˆãƒªã«é–¢ã—ã¦ã¯ã€**å’ç ”ã§ã®è©³ç´°ãªç ”ç©¶å†…å®¹ã‚’æ¼ã‚‰ã•ãªã„**ãŸã‚ã€
ä»Šå›ã®è¨˜äº‹å†…ã«æ·»ä»˜ã—ã¦ã„ã‚‹ç”»åƒå†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å«ã‚€ãƒªãƒã‚¸ãƒˆãƒªã¯å…¬é–‹ã—ã¾ã›ã‚“ã€‚
ã”äº†æ‰¿ãã ã•ã„ã€‚

### ã‚„ã£ãŸã“ã¨

ç ”ç©¶ã§æ‰±ã†é–‹ç™ºç’°å¢ƒã‚’DevContainerã§æ•´ãˆãŸã€‚

### çµŒç·¯

é–‹ç™ºã‚’è¡Œã†ã«ã‚ãŸã£ã¦ã€å®¶ã§é–‹ç™ºã™ã‚‹éš›ã¯ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—PCã€å¤§å­¦å†…ã®è‡ªç¿’å®¤ã‚„ç ”ç©¶å®¤ã§è¡Œã†å ´åˆã¯ãƒãƒ¼ãƒˆPCã§é–‹ç™ºã‚’è¡Œã†ãŸã‚ã€é–‹ç™ºç’°å¢ƒã‚’ãã‚Œãã‚Œã«è¡Œã†ã“ã¨ãŒæ‰‹é–“ã§ã‚ã‚‹ã“ã¨ã‚„ã€ç ”ç©¶ã§è¡Œã†é–‹ç™ºã®ä¸­ã§å°å…¥ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãªã©ãŒã€åˆ¥ã®é–‹ç™ºã‚’è¡Œã†éš›ã«ã€ä»–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨è¡çªã‚’èµ·ã“ã™å¯èƒ½æ€§ã‚’ãªãã—ãŸã‹ã£ãŸã€‚

### ä½•ã‚’å®Ÿç¾ã—ãŸã‹

DevDockerã«ã‚ˆã‚‹ã€ç ”ç©¶ç”¨é–‹ç™ºç’°å¢ƒã‚’ä½œæˆã—ãŸã€‚

### å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆãƒ›ã‚¹ãƒˆå´ï¼‰

```Dockerfile
# ä½¿ã„ã‚„ã™ãã†ãªã®ã§ã€ubuntu:22.04ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹
FROM ubuntu:22.04

# ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€
# 1. apt-get updateã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’æ›´æ–°
# 2. apt-get installã§å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# 3. apt-get cleanã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤
# 4. rm -rf /var/lib/apt/lists/*ã§ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
# ã¨ã„ã†æµã‚Œã§ã€Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹ãŸã‚ã®ã‚‚ã®
# ã¾ãŸã€curlã¨gitã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹
RUN apt-get update && apt-get install -y \
    curl git\
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€
# 1. /usr/local/lib/rustã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
# 2. ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å¯¾ã—ã¦ã€0755ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ä¸ãˆã‚‹
# 3. curlã§rustupã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
# 4. ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã€å®Ÿè¡Œæ¨©é™ã‚’ä¸ãˆã‚‹
# 5. rustup.shã‚’å®Ÿè¡Œã—ã¦ã€rustupã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# 6. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
# ã¨ã„ã†æµã‚Œã§ã€Rustã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹

ENV RUST_HOME /usr/local/lib/rust
ENV RUSTUP_HOME ${RUST_HOME}/rustup 
ENV CARGO_HOME ${RUST_HOME}/cargo 
RUN mkdir /usr/local/lib/rust && \
    chmod 0755 ${RUST_HOME}
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs > ${RUST_HOME}/rustup.sh \
    && chmod +x ${RUST_HOME}/rustup.sh \
    && ${RUST_HOME}/rustup.sh --default-toolchain nightly -y --no-modify-path 

ENV PATH ${PATH}:${CARGO_HOME}/bin


# ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¦ã„ã‚‹
# 1. ARGã§å¤‰æ•°ã‚’å®šç¾©
# 2. apt-get updateã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’æ›´æ–°
# 3. groupaddã§ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
# 4. useraddã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
# 5. sudoã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# 6. sudoers.dã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ 
# 7. ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’å¤‰æ›´
# ã¨ã„ã†æµã‚Œã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¦ã„ã‚‹

ARG USER=dev
ARG UID=1000
ARG GID=${UID}

RUN apt-get update && groupadd -gid ${GID} ${USER} && \
    useradd -s  /bin/bash --uid ${UID} -gid {GID} -m ${NAME} && \
    apt-get install -y sudo && \ 
    echo "${USER} ALL=\(root\) NOPASSWD:ALL" > /etc/sudoers.d/${USER} && \ 
    chmod 0440 /etc/sudoers.d/${USER} 

# æœ¬æ¥ã“ã“ã«ã“ã†ã„ã†ã‚³ãƒ”ãƒ¼æ–‡ã‚’æ›¸ãã¨æ€ã†ãŒã€
# ä»Šå›ã¯docker-compose.ymlã§volumesã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€
# ã“ã“ã«æ›¸ãå¿…è¦ã¯ãªã„

# WORKDIR /guest-workspace
# COPY . .
```

### å‚è€ƒæƒ…å ±
https://github.com/Harurow/docker-playground-rust/blob/main/.devcontainer/Dockerfile
https://c-a-p-engineer.github.io/tech/2022/09/29/docker-rust-install/