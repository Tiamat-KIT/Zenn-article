---
title: "vanilla-extractを使いこなしたい"
emoji: "🙆"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
# vanilla-extract全然わからん
となって、導入を諦めた方、結構いらっしゃるのではないでしょうか。そんな皆さんに朗報です。
この僕がドキュメントを読みに読み漁って実際にコーディングした例から、みなさんにわかりやすく、何ができるかを紹介していきます（この記事は、vanilla-extractが何であるか、どういう利点があるかは**書きません**。ある程度利用して詰まった人向けの記事になります）

## まずは基礎から。
まず、
- vanilla-extractにおけるスタイリングのAPIは入力としてスタイルのオブジェクトをとる。

という仕様になっているため、スタイリングを行うCSSプロパティの集まりが、オブジェクトとして扱われるということ。

### CSSプロパティ
スタイルオブジェクトのトップレベルでは、通常のCSSクラスを記述するのと同様に、CSSプロパティを設定できる。しかし、プロパティ名はキャメルケースで指定しなければならない。
感覚としては`class`→`className`の感覚で考えたらよい。
**※以降では、アスタリスクを「任意の値」の表現として利用します**

```typescript
import {style,globalStyle} from '@vanilla-extract/css';

/* CSSのオブジェクトを作る
これはクラスと同じような扱いでアタッチすることになる。
*/
export const myStyle = style({
    display: '***',
    paddingTop: '***'
});

/*これは、htmlタグ全体に影響するCSSプロパティ*/
globalStyle('body',{
    margin: ***
})
```
#### CSSプロパティ設定時に単位を使用しない場合の仕様
一部のプロパティにおいて、設定値として数値を受付ける。
**単位なしのプロパティを除いて**
これらの値はピクセルとみなされるため、値にpxが自動付与される。つまり、そのようなプロパティには数値を直に入れてもよいということ。
```typescript
import {style} from '@vanilla-extract/css'

export const myStyle = style({
    //自動的にpx単位の値として解釈される。
    padding: ***,

    //単位なしプロパティ
    opacity: ***
})
```
##  ベンダープレフィックス
ベンダ固有プロパティを対象とする場合、パスカルケースを使用して、最初のハイフンを削除することで実現できる。

```typescript 
import {style} from '@vanilla-extract/css'

export const myStyle = style({
    WebkitTapHighlightColor: '***'
});
```

## CSS変数
CSS変数は変数は`var`キーの中に入れ子にする必要がある。
他のCSSプロパティに対して、より正確な静的型付けができる。
(`var`には`createVar`で作成されたスコープ付CSS変数を指定することができる)

```typescript
import {style} from '@vanilla-extract/css'

const myStyle = style({
    vars:{
        '--my-global-variable':'***'
    }
});
```
**or**
```typescript
import {style,createVar} from '@vanilla-extract/css'

const *** = createVar();

const myStyle = style({
    vars:{
        [***]:'***'
    }
});
```
## メディアクエリ
`@media`キーがあり、これを使ってメディアクエリをスタイル定義内に埋め込めるので、
特定のスタイルのレスポンシブデザインのルールを一つに纏められる。
```typescript
import {style} from '@vanilla-extract/css'

const myStyle = style({
    '@media':{
        'screen and (min-width: 768px)':{
            padding: ***
        },
        '(prefers-reduced-motion)':{
            transitionProperty:'***'
        }
    }
});
```

vanilla-extractの仕様として、ファイルの**末尾**にメディアクエリをレンダリングするようになっている。
これはCSS規則の順序の優先順序によって、`@media`キーの中のスタイルが常に他のスタイルよりも
高い優先順位を持つこと意味する。
※ちなみに、安全であれば`@media`,`@supports`,`@container`の条件ブロックを取り除いて、
可能な限り小さなCSS出力を作成する仕様。

## セレクタ
スタイルに対してセレクタを指定する方法は、
- 他のすべてのCSSプロパティと一緒に使用できる単純な擬似セレクタ
    パラメータを取らないので、簡単に検出できて静的に型付けされる
    これらは、他のCSSプロパティと並んでトップレベルで使用する可能で、
    CSSプロパティとCSS変数のみを含むことが可能。
    ```typescript
    import {style} from '@vanilla-extract/css'

    const myStyle = style({
        `hover`:{
            color:'***'
        },
        ':first-of-type':{
            color:'***'
        },
        '::before'{
            content: '***'
        }
    });
    ```
- より複雑なルールを構築できるセレクタオプション
    複雑なセレクタ セレクタキーを使って、より複雑なルールを記述可能。
    保守性を高めるため、各スタイル ブロックは 1 つの要素のみを対象とすることが可能。
    これを強制するため、全セレクタは**現在の要素への参照である & 文字をターゲット**
    にしなければならない。
    ```typescript
    import {style} from '@vanilla-extract/css'

    const link = style({
        selectors:{
            '&:hovers:not(:active)':{
                border: '***'
            },
            'nav li > &':{
                textDecoration:'***'
            }
        }
    })
    ```

    セレクタは、他のスコープされたクラス名を参照することも可能

    ```typescript
    import {style} from '@vanilla-extract/css'

    export const parent = style({});

    export const child = style({
        selectors:{
            [`${parent}:focus &`]:{
                background: '***'
            }
        }
    });
    ```

無効なセレクタとは、現在のクラス以外の要素をターゲットにしようとするもの。

```typescript
import { style } from '@vanilla-extract/css';

const invalid = style({
  selectors: {
    // ❌ ERROR: Targetting `a[href]`
    '& a[href]': {...},

    // ❌ ERROR: Targetting `.otherClass`
    '& ~ div > .otherClass': {...}
  }
});

```
他のスコープを持つクラスをターゲットにする場合は、
代わりにそのクラスのスタイルブロック内で定義する必要があります。

```typescript
import { style } from '@vanilla-extract/css';

// Invalid example:
export const child = style({});
export const parent = style({
  selectors: {
    // ❌ ERROR: Targetting `child` from `parent`
    [`& ${child}`]: {...}
  }
});

// Valid example:
export const parent = style({});
export const child = style({
  selectors: {
    [`${parent} &`]: {...}
  }
});
```

現在の要素内の子ノードをグローバルにターゲットにする必要がある場合 
代わりに globalStyle を使用する必要があります。
```typescript
import { style, globalStyle } from '@vanilla-extract/css';

export const parent = style({});

globalStyle(`${parent} a[href]`, {
  color: 'pink'
});
```

※**`globalStyle`では、すべてのセレクタを使用不可**。
この API はセレクタを最初のパラメータとして受け付けるため 
セレクタをマージすると予期しない結果が生じる可能性があるから。
